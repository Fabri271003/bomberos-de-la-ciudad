<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomberos de la Ciudad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles that can't be done with Tailwind */
        .blinking {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #0c4a6e 100%);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg text-white font-sans">
    <!-- Login Overlay -->
    <div id="loginOverlay" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Nombre y NÂ° de legajo</h2>
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">Nombre</label>
                <input type="text" id="usernameInput" class="w-full bg-gray-700 rounded p-2" placeholder="Enter your name">
            </div>
            <button id="loginBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
                <i class="fas fa-sign-in-alt mr-2"></i>Ingresar
            </button>
        </div>
    </div>
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-12">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-fire text-red-500 text-4xl mr-3"></i>
                <h1 class="text-3xl font-bold">Bomberos de la Ciudad</h1>
            </div>
            <div id="userInfo" class="hidden ml-4 md:ml-8">
                <span class="text-gray-300">Inciado como:</span>
                <span id="usernameDisplay" class="font-semibold ml-2"></span>
                <button id="logoutBtn" class="ml-4 text-blue-400 hover:text-blue-300">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            <div class="flex space-x-4">
                <button id="toggleTimerBtn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg font-semibold transition-all">
                    <i class="fas fa-play mr-2"></i>Iniciar 
                </button>
                <button id="toggleViewBtn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-semibold transition-all">
                    <i class="fas fa-exchange-alt mr-2"></i>Cambiar de modo
                </button>
            </div>
        </header>

        <!-- Main Content - Tabs -->
        <main>
            <!-- Timer Dashboard -->
            <div id="timerView" class="bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-lg mb-8">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                    <div class="text-center md:text-left mb-4 md:mb-0">
                        <h2 class="text-2xl font-bold mb-2">Tiempo de Servicio</h2>
                        <p class="text-gray-300">Revisa tu tiempo de servicio</p>
                    </div>
                    <div class="text-center">
                        <div id="timerDisplay" class="text-5xl font-mono font-bold mb-2 blinking">00:00:00</div>
                        <div class="flex justify-center space-x-4">
                            <button id="pauseBtn" class="bg-yellow-500 hover:bg-yellow-600 px-4 py-1 rounded-lg hidden">
                                <i class="fas fa-pause mr-2"></i>Pausa
                            </button>
                            <button id="endShiftBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-1 rounded-lg hidden">
                                <i class="fas fa-stop mr-2"></i>Terminar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-black/20 rounded-lg p-4">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-history mr-2"></i>Tiempo de Guardia
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="py-2 text-left">Nombre</th>
                                    <th class="py-2 text-left">Fecha</th>
                                    <th class="py-2 text-left">Hora de incio</th>
                                    <th class="py-2 text-left">Hora de finalizacion</th>
                                    <th class="py-2 text-left">Duracion</th>
                                </tr>
                            </thead>
                            <tbody id="shiftHistory">
                                <!-- Shift records will be added here -->
                                <tr class="border-b border-gray-600/50">
                                    <td colspan="4" class="py-4 text-center text-gray-400">No hay registro de Servicio</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 911 Call Log Dashboard -->
            <div id="callLogView" class="bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-lg hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-phone-alt text-red-500 mr-2"></i>911 Registro de llamadas
                    </h2>
                    <button id="newCallBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Nueva Llamada
                    </button>
                </div>

                <!-- Call Log Table -->
                <div class="bg-black/20 rounded-lg p-4 mb-6">
                    <div class="overflow-y-auto max-h-96 scrollbar-hide">
                        <table class="w-full">
                            <thead class="sticky top-0 bg-gray-800">
                                <tr>
                                    <th class="py-2 text-left">Numero de llamada</th>
                                    <th class="py-2 text-left">Hora</th>
                                    <th class="py-2 text-left">Ubicacion</th>
                                    <th class="py-2 text-left">Tipo</th>
                                    <th class="py-2 text-left">Estado</th>
                                    <th class="py-2 text-left">Accion</th>
                                </tr>
                            </thead>
                            <tbody id="callLogTable">
                                <!-- Call records will be added here -->
                                <tr class="border-b border-gray-600/50">
                                    <td colspan="6" class="py-4 text-center text-gray-400">No hay registro de llamadas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Call Details Section -->
                <div id="callDetails" class="bg-black/20 rounded-lg p-4 hidden">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-file-alt mr-2"></i>Detalles de la llamada
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">nombre del denunciante</label>
                                <input type="text" id="callerName" class="w-full bg-gray-700 rounded p-2">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">numero del denunciante</label>
                                <input type="text" id="callerPhone" class="w-full bg-gray-700 rounded p-2">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">Ubicacion</label>
                                <input type="text" id="callLocation" class="w-full bg-gray-700 rounded p-2">
                            </div>
                        </div>
                        <div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">Tipo de emergencia</label>
                                <select id="callType" class="w-full bg-gray-700 rounded p-2">
                                    <option value="Fire">Incendio Forestal-Estructural</option>
                                    <option value="Medical">Medico</option>
                                    <option value="Rescue">Rescate</option>
                                    <option value="Hazardous Material">Materiales Peligrosos</option>
                                    <option value="Other">Otros</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">Prioridad</label>
                                <select id="callPriority" class="w-full bg-gray-700 rounded p-2">
                                    <option value="Low">Lento</option>
                                    <option value="Medium">Medio</option>
                                    <option value="High" selected>Rapido</option>
                                    <option value="Emergency">Emergencia</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">Estado</label>
                                <select id="callStatus" class="w-full bg-gray-700 rounded p-2">
                                    <option value="Pending">Pendiente</option>
                                    <option value="Dispatched">En ruta</option>
                                    <option value="On Scene">En la escena</option>
                                    <option value="Resolved">Resuelto</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">Descripcion</label>
                        <textarea id="callDescription" rows="4" class="w-full bg-gray-700 rounded p-2"></textarea>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">notas</label>
                        <textarea id="callResponse" rows="4" class="w-full bg-gray-700 rounded p-2"></textarea>
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button id="cancelCallBtn" class="bg-gray-600 hover:bg-gray-700 px-6 py-2 rounded-lg">
                            <i class="fas fa-times mr-2"></i>Cancelar
                        </button>
                        <button id="saveCallBtn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg">
                            <i class="fas fa-save mr-2"></i>Guardar
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-400 text-sm">
            <p>Bomberos de la Ciudad&copy; 2025 | Hecho por el Cabo 1 Fabricio Caseres <i class="fas fa-heart text-red-500"></i> Para los bomberos de la ciudad</p>
        </footer>
    </div>

    <script>
        // Login Elements
        const loginOverlay = document.getElementById('loginOverlay');
        const usernameInput = document.getElementById('usernameInput');
        const loginBtn = document.getElementById('loginBtn');
        const userInfo = document.getElementById('userInfo');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const logoutBtn = document.getElementById('logoutBtn');

        // DOM Elements
        const toggleTimerBtn = document.getElementById('toggleTimerBtn');
        const toggleViewBtn = document.getElementById('toggleViewBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const pauseBtn = document.getElementById('pauseBtn');
        const endShiftBtn = document.getElementById('endShiftBtn');
        const shiftHistory = document.getElementById('shiftHistory');
        const timerView = document.getElementById('timerView');
        const callLogView = document.getElementById('callLogView');
        const newCallBtn = document.getElementById('newCallBtn');
        const callLogTable = document.getElementById('callLogTable');
        const callDetails = document.getElementById('callDetails');
        const saveCallBtn = document.getElementById('saveCallBtn');
        const cancelCallBtn = document.getElementById('cancelCallBtn');

        // Timer Variables
        let timerInterval;
        let seconds = 0;
        let isRunning = false;
        let isPaused = false;
        let currentShiftStart = null;
        let editingCallId = null;

        // Shift History Data
        let shifts = JSON.parse(localStorage.getItem('shifts')) || [];

        // Call Log Data
        let calls = JSON.parse(localStorage.getItem('calls')) || [];
        
        // User Management
        function checkLogin() {
            const username = localStorage.getItem('firefighterUsername');
            if (username) {
                loginOverlay.classList.add('hidden');
                userInfo.classList.remove('hidden');
                usernameDisplay.textContent = username;
            } else {
                loginOverlay.classList.remove('hidden');
            }
        }

        function login() {
            const username = usernameInput.value.trim();
            if (username) {
                localStorage.setItem('firefighterUsername', username);
                checkLogin();
            }
        }

        function logout() {
            localStorage.removeItem('firefighterUsername');
            loginOverlay.classList.remove('hidden');
            userInfo.classList.add('hidden');
            usernameInput.value = '';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            checkLogin();
            updateShiftHistory();
            updateCallLogTable();
        });

        // Event Listeners for login
        loginBtn.addEventListener('click', login);
        logoutBtn.addEventListener('click', logout);
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        // Timer Functions
        function startTimer() {
            if (!isRunning) {
                currentShiftStart = new Date();
                isRunning = true;
                timerInterval = setInterval(updateTimer, 1000);
                toggleTimerBtn.innerHTML = '<i class="fas fa-running mr-2"></i>Shift Active';
                toggleTimerBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                toggleTimerBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                pauseBtn.classList.remove('hidden');
                endShiftBtn.classList.remove('hidden');
                timerDisplay.classList.add('blinking');
            }
        }

        function pauseTimer() {
            if (isRunning && !isPaused) {
                clearInterval(timerInterval);
                isPaused = true;
                pauseBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Resume';
                timerDisplay.classList.remove('blinking');
            } else if (isRunning && isPaused) {
                timerInterval = setInterval(updateTimer, 1000);
                isPaused = false;
                pauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
                timerDisplay.classList.add('blinking');
            }
        }

        function endShift() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                isPaused = false;
                
                // Save the shift
                const shiftEnd = new Date();
                const shiftDuration = formatTime(seconds);
                
                const shift = {
                    id: Date.now(),
                    username: localStorage.getItem('firefighterUsername'),
                    date: currentShiftStart.toLocaleDateString(),
                    startTime: currentShiftStart.toLocaleTimeString(),
                    endTime: shiftEnd.toLocaleTimeString(),
                    duration: shiftDuration
                };
                
                shifts.push(shift);
                localStorage.setItem('shifts', JSON.stringify(shifts));
                
                // Reset UI
                toggleTimerBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Start Shift';
                toggleTimerBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                toggleTimerBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                pauseBtn.classList.add('hidden');
                endShiftBtn.classList.add('hidden');
                timerDisplay.classList.remove('blinking');
                
                seconds = 0;
                timerDisplay.textContent = '00:00:00';
                
                updateShiftHistory();
            }
        }

        function updateTimer() {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
        }

        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':');
        }

        function updateShiftHistory() {
            if (shifts.length === 0) {
                shiftHistory.innerHTML = `
                    <tr class="border-b border-gray-600/50">
                        <td colspan="4" class="py-4 text-center text-gray-400">No shift records yet</td>
                    </tr>
                `;
                return;
            }
            
            shiftHistory.innerHTML = shifts.map(shift => `
                <tr class="border-b border-gray-600/50 hover:bg-white/5">
                    <td class="py-3">${shift.username}</td>
                    <td class="py-3">${shift.date}</td>
                    <td class="py-3">${shift.startTime}</td>
                    <td class="py-3">${shift.endTime}</td>
                    <td class="py-3">${shift.duration}</td>
                </tr>
            `).join('');
        }

        // Call Log Functions
        function updateCallLogTable() {
            if (calls.length === 0) {
                callLogTable.innerHTML = `
                    <tr class="border-b border-gray-600/50">
                        <td colspan="6" class="py-4 text-center text-gray-400">No call records yet</td>
                    </tr>
                `;
                return;
            }
            
            callLogTable.innerHTML = calls.map(call => `
                <tr class="border-b border-gray-600/50 hover:bg-white/5">
                    <td class="py-3">${call.id}</td>
                    <td class="py-3">${call.time}</td>
                    <td class="py-3">${call.location}</td>
                    <td class="py-3">${call.type}</td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded-full text-xs 
                            ${call.status === 'Resolved' ? 'bg-green-600' : 
                              call.status === 'Pending' ? 'bg-yellow-600' : 
                              call.status === 'Dispatched' ? 'bg-blue-600' : 'bg-red-600'}">
                            ${call.status}
                        </span>
                    </td>
                    <td class="py-3">
                        <button onclick="editCall(${call.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteCall(${call.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function editCall(id) {
            const call = calls.find(c => c.id === id);
            if (!call) return;
            
            editingCallId = id;
            
            // Fill the form
            document.getElementById('callerName').value = call.callerName;
            document.getElementById('callerPhone').value = call.callerPhone;
            document.getElementById('callLocation').value = call.location;
            document.getElementById('callType').value = call.type;
            document.getElementById('callPriority').value = call.priority;
            document.getElementById('callStatus').value = call.status;
            document.getElementById('callDescription').value = call.description;
            document.getElementById('callResponse').value = call.response || '';
            
            // Show the form
            callDetails.classList.remove('hidden');
            callLogTable.parentElement.classList.add('hidden');
            newCallBtn.classList.add('hidden');
        }

        function deleteCall(id) {
            if (confirm('Are you sure you want to delete this call?')) {
                calls = calls.filter(c => c.id !== id);
                localStorage.setItem('calls', JSON.stringify(calls));
                updateCallLogTable();
            }
        }

        function saveCall() {
            const callerName = document.getElementById('callerName').value.trim();
            const callerPhone = document.getElementById('callerPhone').value.trim();
            const location = document.getElementById('callLocation').value.trim();
            const type = document.getElementById('callType').value;
            const priority = document.getElementById('callPriority').value;
            const status = document.getElementById('callStatus').value;
            const description = document.getElementById('callDescription').value.trim();
            const response = document.getElementById('callResponse').value.trim();
            
            if (!callerName || !location || !description) {
                alert('Please fill in all required fields (Caller Name, Location, Description)');
                return;
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            if (editingCallId) {
                // Update existing call
                const index = calls.findIndex(c => c.id === editingCallId);
                if (index !== -1) {
                    calls[index] = {
                        ...calls[index],
                        callerName,
                        callerPhone,
                        location,
                        type,
                        priority,
                        status,
                        description,
                        response,
                        time: timeString
                    };
                }
            } else {
                // Create new call
                const newCall = {
                    id: Date.now(),
                    time: timeString,
                    callerName,
                    callerPhone,
                    location,
                    type,
                    priority,
                    status,
                    description,
                    response
                };
                calls.push(newCall);
            }
            
            localStorage.setItem('calls', JSON.stringify(calls));
            resetCallForm();
            updateCallLogTable();
        }

        function resetCallForm() {
            document.getElementById('callerName').value = '';
            document.getElementById('callerPhone').value = '';
            document.getElementById('callLocation').value = '';
            document.getElementById('callType').value = 'Fire';
            document.getElementById('callPriority').value = 'High';
            document.getElementById('callStatus').value = 'Pending';
            document.getElementById('callDescription').value = '';
            document.getElementById('callResponse').value = '';
            
            callDetails.classList.add('hidden');
            callLogTable.parentElement.classList.remove('hidden');
            newCallBtn.classList.remove('hidden');
            editingCallId = null;
        }

        // Event Listeners
        toggleTimerBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        endShiftBtn.addEventListener('click', endShift);

        toggleViewBtn.addEventListener('click', () => {
            timerView.classList.toggle('hidden');
            callLogView.classList.toggle('hidden');
            
            if (callLogView.classList.contains('hidden')) {
                toggleViewBtn.innerHTML = '<i class="fas fa-exchange-alt mr-2"></i>Switch to Call Log';
            } else {
                toggleViewBtn.innerHTML = '<i class="fas fa-exchange-alt mr-2"></i>Switch to Timer';
            }
        });

        newCallBtn.addEventListener('click', () => {
            resetCallForm();
            callDetails.classList.remove('hidden');
            callLogTable.parentElement.classList.add('hidden');
            newCallBtn.classList.add('hidden');
        });

        saveCallBtn.addEventListener('click', saveCall);
        cancelCallBtn.addEventListener('click', resetCallForm);

        // Make functions available globally for the inline event handlers in the table
        window.editCall = editCall;
        window.deleteCall = deleteCall;
    </script>
</body>
</html>